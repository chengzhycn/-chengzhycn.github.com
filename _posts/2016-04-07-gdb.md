---
layout: post
title:  "gdb调试工具小结"
date:   2016-04-07 14:23:00
categories: C/C++
excerpt:    gdb debug
---

* content
{:toc}

在c语言 debug过程中，常说有三种方式：printf、assert和gdb。在这里对调试过程中dgb的使用做一个小结（备忘）。后续不断补充......

## gdb简介

gdb全称 GNU Project debugger，是UNIX和UNIX-like系统下一款十分强大的代码调试工具。主要功能有设置断点，在断点处检查参数值等等。

## gdb使用

使用gdb一般要在编译程序时添加 -g 参数，是为了能在调试过程中方便地查看调试信息。不添加也能正常调试，不过显示的参数都是内存地址，调试起来极不方便。目前linux下gcc和clang都已支持gdb调试。

    gcc -o test.o test.c -g
    clang - o test.o test.c -g
    
启动调试：

    gdb test.o
    
启动后即进入了gdb控制台界面：

    GNU gdb (Ubuntu 7.11-0ubuntu1) 7.11
    Copyright (C) 2016 Free Software Foundation, Inc.
    License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
    This is free software: you are free to change and redistribute it.
    There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
    and "show warranty" for details.
    This GDB was configured as "x86_64-linux-gnu".
    Type "show configuration" for configuration details.
    For bug reporting instructions, please see:
    <http://www.gnu.org/software/gdb/bugs/>.
    Find the GDB manual and other documentation resources online at:
    <http://www.gnu.org/software/gdb/documentation/>.
    For help, type "help".
    Type "apropos word" to search for commands related to "word"...
    Reading symbols from test...(no debugging symbols found)...done.
    (gdb) 
    
在gdb控制台内，有如下的常用命令：

-   b(break)    设置断点    设置断点可以直接指定断点的行数，也可以指定函数名。在多文件编译调试时，设置断点可以用 [filename]:[line] 的格式：

        (gdb) b 10
        Breakpoint 1 at 0x400a41: file debug_main.c, line 10.
        (gdb) b configParser
        Breakpoint 2 at 0x4010e3: file configParser.c, line 165.
        (gdb) b configParser.c:10
        Breakpoint 3 at 0x400c25: file configParser.c, line 10.

-   l(list)         显示代码    list可以一次性显示10行源代码。后面接行数可以显示该行前后各5行代码：

        (gdb) l 23
        18	/* Includes ------------------------------------------------------------------*/
        19	#include <stdio.h>
        20	#include <stdlib.h>
        21	#include <string.h>
        22	#include "configParser.h"
        23	
        24	typedef struct {
        25	    int tun_fd;
        26	    int num;
        27	    char *DTNEth;

-   set args    设置运行参数      有时候执行代码会跟一些参数，这时候可以在控制台内设置参数，设置时不需要执行文件名（即argv[0]）。用show args可以查看设置的参数：

        (gdb) set args -t 12 -c 345
        (gdb) show args
        Argument list to give program being debugged when it is started is "-t 12 -c 345".
        
-   r(run)      运行程序        运行程序直到程序结束或者遇到断点为止
-   c(continue)     继续       在遇到断点停止后，从断点处继续运行程序
-   n(next)     单步调试       
-   p(print)    打印参数       需要查看当前断点处参数值时可以使用p打印。如果是数组、指针之类的还可以使用@指定长度打印：

        (gdb) p num
        $1 = 2
        (gdb) p n
        $2 = (nodeInfo *) 0x603010
        (gdb) p n->dstName
        $3 = (char **) 0x603040
        (gdb) p *n->dstName
        $4 = 0x603120 "node1"
        (gdb) p *n->dstName@2
        $5 = {0x603120 "node1", 0x603180 "node2"}

-   file    指定执行文件  有时候调试安装后的程序时因为当前目录下可能只是个链接，gdb报错：

        No symbol table is loaded.  Use the "file" command.            

这时候首先在命令行内使用<code>type filename</code> 定位到执行文件位置，再在gdb控制台内使用file重新定位到执行文件位置。